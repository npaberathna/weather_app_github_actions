name: API Health Check

on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 */6 * * *'

jobs:
  api-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Check OpenWeatherMap API
        run: |
          echo "ğŸŒ¤ï¸ Checking Weather API..."
          response=$(curl -s -o /dev/null -w "%{http_code}" "https://api.openweathermap.org/data/2.5/weather?q=London&appid=demo")
          if [ "$response" == "200" ] || [ "$response" == "401" ]; then
            echo "âœ… API is reachable!"
          else
            echo "âŒ API may be down (Status: $response)"
          fi
      
      - name: Check GitHub Pages
        run: |
          echo "ğŸŒ Checking deployment..."
          status=$(curl -s -o /dev/null -w "%{http_code}" "https://manojaberathna24.github.io/Weather_Dashboard_CI-CD-pipeline-/")
          if [ "$status" == "200" ]; then
            echo "âœ… Website is live!"
          else
            echo "âš ï¸ Website status: $status"
          fi
      
      - name: Health check complete
        run: echo "ğŸ‰ All health checks completed!"